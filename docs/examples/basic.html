<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0, shrink-to-fit=no">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<title>Embedding.js basic example</title>

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r81/three.min.js"></script>
		<script type="text/javascript" src="js/VRControls.js"></script>
		<script type="text/javascript" src="js/VREffect.js"></script>
		<script type="text/javascript" src="js/webvr-polyfill.js"></script>
		<script type="text/javascript" src="js/webvr-manager.js"></script>

		<style>
			/* Ensures that the canvas fills the entire window, and that there are no scrollbars */
			body {
				width: 100%;
				height: 100%;
				background-color: #000;
				color: #fff;
				margin: 0px;
				padding: 0;
				overflow: hidden;
			}
		</style>
	</head>
	<body>
		<script src="js/embedding.js"></script>
		<script>
		const { scene, camera, manager, effect, cameraControls, hud } = EMBED.initScene();
		var dataset, embedding;
		var N = 1;
		var c = 0;

		initEmbedding();
		EMBED.startAnimation();

		function initEmbedding() {
			hud.setText('some text that really should appear in the scene and I hopeit does oh please!')

			dataset = new EMBED.Dataset();
			var f = function() {
				for (let i = 0; i < N; i++) {
					let dp = { _id: c, 
							x: -4 + 8*Math.random(), 
							y: -4 + 8*Math.random(), 
							z: -4 + 8*Math.random() };
					dataset.add(dp);
					c++;
					// console.log('added', dp);
				}
			};
			window.setInterval(f, 200);
			var g = function() {
				let ids = Object.keys(dataset.datapoints);
				M = ids.length;
				let i = Math.floor(Math.random() * M);
				let id = ids[i];
				dataset.remove(id);
			}
			window.setInterval(g, 500);
			var h = function() {
				let ids = Object.keys(dataset.datapoints);
				M = ids.length;
				let i = Math.floor(Math.random() * M);
				let id = ids[i];
				dataset.update(id, 'x', -4 + 8*Math.random());	
				dataset.update(id, 'y', -4 + 8*Math.random());	
				dataset.update(id, 'z', -4 + 8*Math.random());	
			}
			window.setInterval(h, 200);

			embedding = new EMBED.ScatterEmbedding(
				scene, dataset, {pointSize: 0.5, pointColor: 0x993333, moveSpeed: 3});
			EMBED.register(embedding);
		}

		</script>
	</body>
</html>